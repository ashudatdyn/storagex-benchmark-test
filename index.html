<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StorageX & Elasticsearch Performance Benchmark Plan</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Tailwind Config for Custom Colors -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: {
                            850: '#1e293b',
                            900: '#0f172a',
                        },
                        brand: {
                            blue: '#3b82f6',
                            teal: '#14b8a6',
                            indigo: '#6366f1'
                        }
                    }
                }
            }
        }
    </script>
    <style>
        /* Chart Container Styling - Mandatory Requirements */
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 100%; /* Adapts to column width */
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        
        /* Custom Scrollbar for list views */
        .custom-scroll::-webkit-scrollbar {
            width: 8px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f5f9;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }
        .custom-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        .active-row {
            background-color: #eff6ff; /* blue-50 */
            border-left: 4px solid #3b82f6; /* blue-500 */
        }
    </style>
    <!-- Chosen Palette: Slate (Backgrounds), Blue/Teal/Indigo (Accents) - Professional, Technical, Clean -->
    <!-- Application Structure Plan: 
        1. **Executive Summary Dashboard:** Top-level metrics (Total files, data volume) to give immediate scope context.
        2. **Interactive Test Matrix:** The core workspace. A split-pane view with a filterable list of Test Cases on the left and a detailed "Data Card" on the right. This allows users to browse the plan without being overwhelmed by a giant table.
        3. **Performance Forecast:** A dedicated section with visualizations comparing the 'Expected Baseline' performance metrics across test cases, helping identify which tests are expected to be bottlenecks.
        4. **Technical Specifications:** A tabbed or accordion section for the deep technical details (Queries, Generation Strategy) that are needed during execution but not for high-level planning.
        Reasoning: The report is a dense technical plan. The SPA unpacks this into "Planning" (Dashboard), "Execution" (Matrix), and "Analysis" (Forecast) phases for better usability.
    -->
    <!-- Visualization & Content Choices:
        1. **Goal: Inform (Scope):** Summary Cards. Simple text/number display.
        2. **Goal: Compare (Performance):** Bar Chart (Grouped). Compares Crawl vs Index rates per Test Case. Chart.js used.
        3. **Goal: Organize (Test Cases):** Interactive List + Detail View. Replaces the static table. JS filtering handles categories.
        4. **Goal: Inform (Constraints):** Doughnut Chart. Visualizes the 40/40/20 file size distribution rule.
        5. **Goal: Inform (Validation):** Pre-formatted code blocks for KQL/Aggregations.
        CONFIRMATION: NO SVG graphics used. NO Mermaid JS used.
    -->
</head>
<body class="bg-slate-50 text-slate-800 font-sans leading-normal">

    <!-- Navigation / Header -->
    <nav class="bg-white shadow-sm border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0 flex items-center gap-2">
                        <span class="text-2xl text-blue-600 font-bold">‚ö°</span>
                        <h1 class="text-xl font-bold text-slate-900 tracking-tight">StorageX Scan test benchmarks <span class="text-slate-400 font-normal">| StorageX & Elasticsearch 8.x</span></h1>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-slate-500 bg-slate-100 px-3 py-1 rounded-full">v1.0 Release</span>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Wrapper -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">

        <!-- Section 1: Executive Summary -->
        <section class="animate-fade-in-up">
            <div class="mb-4">
                <h2 class="text-2xl font-bold text-slate-900">Benchmark Scope Overview</h2>
                <p class="text-slate-600 mt-1">
                    High-level summary of the dataset generation requirements and target objectives. This plan is designed to validate StorageX crawling efficiency and Elasticsearch 8.x indexing throughput under enterprise conditions.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <!-- KPI Card 1 -->
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 flex flex-col justify-between hover:shadow-md transition-shadow">
                    <div>
                        <p class="text-sm font-medium text-slate-500 uppercase tracking-wider">Total Test Cases</p>
                        <p class="text-3xl font-bold text-slate-900 mt-2" id="total-tc">15</p>
                    </div>
                    <div class="mt-4 flex items-center text-sm text-blue-600">
                        <span>Functional & Stress Scenarios</span>
                    </div>
                </div>
                <!-- KPI Card 2 -->
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 flex flex-col justify-between hover:shadow-md transition-shadow">
                    <div>
                        <p class="text-sm font-medium text-slate-500 uppercase tracking-wider">Total Files to Gen</p>
                        <p class="text-3xl font-bold text-slate-900 mt-2" id="total-files">9.2M</p>
                    </div>
                    <div class="mt-4 flex items-center text-sm text-teal-600">
                        <span>Across all profiles</span>
                    </div>
                </div>
                <!-- KPI Card 3 -->
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 flex flex-col justify-between hover:shadow-md transition-shadow">
                    <div>
                        <p class="text-sm font-medium text-slate-500 uppercase tracking-wider">Total Data Volume</p>
                        <p class="text-3xl font-bold text-slate-900 mt-2" id="total-volume">~50 TB</p>
                    </div>
                    <div class="mt-4 flex items-center text-sm text-indigo-600">
                        <span>Max File Size: 1 GB</span>
                    </div>
                </div>
                <!-- KPI Card 4: Chart -->
                <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-4 flex flex-col items-center justify-center">
                    <p class="text-xs font-medium text-slate-500 uppercase mb-2 w-full text-left">Distribution Constraint</p>
                    <div class="h-24 w-full flex justify-center">
                        <div class="chart-container" style="height: 100px; max-height: 100px;">
                            <canvas id="distChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: Interactive Test Matrix -->
        <section class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="p-6 border-b border-slate-200 bg-slate-50/50 flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                    <h2 class="text-xl font-bold text-slate-900">Test Execution Matrix</h2>
                    <p class="text-sm text-slate-600">Select a test case to view detailed requirements, metrics, and generation strategies.</p>
                </div>
                <div class="flex space-x-2">
                    <button onclick="filterTests('all')" class="filter-btn active px-4 py-2 text-sm font-medium rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition-colors shadow-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" data-filter="all">All Tests</button>
                    <button onclick="filterTests('Functional Baseline')" class="filter-btn px-4 py-2 text-sm font-medium rounded-lg bg-white text-slate-700 border border-slate-300 hover:bg-slate-50 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" data-filter="Functional Baseline">Functional</button>
                    <button onclick="filterTests('Scale & Stress')" class="filter-btn px-4 py-2 text-sm font-medium rounded-lg bg-white text-slate-700 border border-slate-300 hover:bg-slate-50 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" data-filter="Scale & Stress">Scale</button>
                    <button onclick="filterTests('Metadata Stress')" class="filter-btn px-4 py-2 text-sm font-medium rounded-lg bg-white text-slate-700 border border-slate-300 hover:bg-slate-50 transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500" data-filter="Metadata Stress">Stress</button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 h-[600px]">
                <!-- Left Column: Test Case List -->
                <div class="col-span-1 border-r border-slate-200 overflow-y-auto custom-scroll bg-white">
                    <div id="tc-list" class="divide-y divide-slate-100">
                        <!-- Content populated by JS -->
                    </div>
                </div>

                <!-- Right Column: Detail View -->
                <div class="col-span-1 lg:col-span-2 overflow-y-auto custom-scroll bg-slate-50/30 p-6 md:p-8">
                    <div id="tc-detail-content">
                        <!-- Content populated by JS -->
                        <div class="flex flex-col items-center justify-center h-full text-slate-400">
                            <span class="text-4xl mb-2">üëà</span>
                            <p>Select a Test Case from the list to view details</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 3: Performance Forecast -->
        <section class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-2 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                <div class="mb-6">
                    <h2 class="text-xl font-bold text-slate-900">Performance Forecast Baseline</h2>
                    <p class="text-sm text-slate-600">Comparision of expected throughput (Files/Sec vs Docs/Sec) across selected test cases. Use this to identify expected bottlenecks.</p>
                </div>
                <div class="chart-container">
                    <canvas id="perfChart"></canvas>
                </div>
            </div>

            <div class="lg:col-span-1 space-y-6">
                 <!-- Toolchain Strategy -->
                 <div class="bg-indigo-50 rounded-xl border border-indigo-100 p-6">
                    <h3 class="text-lg font-bold text-indigo-900 mb-3">üõ†Ô∏è Data Gen Toolchain</h3>
                    <ul class="space-y-3 text-sm text-indigo-800">
                        <li class="flex items-start">
                            <span class="mr-2">üêç</span>
                            <span><strong>Python Orchestrator:</strong> Routes creation 40/40/20. Uses <code>multiprocessing</code>.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2">üíæ</span>
                            <span><strong>FIO:</strong> Generates incompressible payloads for large files.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2">üìÇ</span>
                            <span><strong>Bash:</strong> Rapid directory tree recursion for deep paths.</span>
                        </li>
                        <li class="flex items-start">
                            <span class="mr-2">üõ°Ô∏è</span>
                            <span><strong>PowerShell:</strong> Injects complex NTFS ACLs via AD groups.</span>
                        </li>
                    </ul>
                </div>
                
                <!-- Quick Legend -->
                <div class="bg-white rounded-xl border border-slate-200 p-6">
                    <h3 class="text-sm font-bold text-slate-900 uppercase tracking-wider mb-4">Metric Definitions</h3>
                    <div class="space-y-3 text-sm">
                        <div>
                            <span class="font-semibold text-blue-600">Crawl Throughput:</span>
                            <p class="text-slate-500">Rate at which StorageX enumerates files.</p>
                        </div>
                        <div>
                            <span class="font-semibold text-teal-600">Indexing Rate:</span>
                            <p class="text-slate-500">Rate at which metadata documents persist in ES.</p>
                        </div>
                        <div>
                            <span class="font-semibold text-slate-700">P95 Latency:</span>
                            <p class="text-slate-500">95% of requests complete faster than this time.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 4: Technical Specs (Queries) -->
        <section class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
            <div class="p-6 bg-slate-50 border-b border-slate-200">
                <h2 class="text-xl font-bold text-slate-900">Elasticsearch Validation Queries</h2>
                <p class="text-sm text-slate-600">Run these via Kibana Dev Tools to validate ingestion quality and cluster performance.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 divide-y md:divide-y-0 md:divide-x divide-slate-200">
                <div class="p-6">
                    <h3 class="text-sm font-bold text-slate-700 uppercase mb-3">KQL Discovery Filters</h3>
                    <div class="bg-slate-900 rounded-lg p-4 font-mono text-xs text-green-400 overflow-x-auto">
<pre># 1. High-value targets
extension.keyword : "pst"

# 2. Large Files (>100MB)
file_size > 100000000

# 3. Deeply Nested Data
path_depth > 20

# 4. ACL Validation
exists:acl_entries</pre>
                    </div>
                </div>
                <div class="p-6">
                    <h3 class="text-sm font-bold text-slate-700 uppercase mb-3">Aggregation Payload (Dev Tools)</h3>
                    <div class="bg-slate-900 rounded-lg p-4 font-mono text-xs text-blue-300 overflow-x-auto h-48 custom-scroll">
<pre>GET /storagex-metadata-*/_search
{
  "size": 0,
  "aggs": {
    "unique_owners": { 
      "cardinality": { "field": "owner.keyword" } 
    },
    "file_size_distribution": {
      "histogram": { 
        "field": "file_size", 
        "interval": 10485760 
      }
    },
    "crawl_time_stats": { 
      "stats": { "field": "crawl_timestamp" } 
    }
  }
}</pre>
                    </div>
                </div>
            </div>
        </section>

        <footer class="text-center text-slate-400 text-sm py-8">
            <p>Generated based on Performance Benchmark Test Plan</p>
        </footer>

    </main>

    <!-- JavaScript Logic -->
    <script>
        // --- DATA MODEL ---
        const testCases = [
            {
                id: "TC-001", name: "HR Share Baseline", category: "Functional Baseline",
                files: "50,000", size: "100 GB", avgSize: "2 MB",
                depth: "3‚Äì5 levels", acl: "Standard (5-10 ACEs)",
                objective: "Establish baseline for standard departmental unstructured data.",
                metricsSX: ["Crawl Throughput", "Extract latency", "CPU utilization"],
                metricsES: ["Indexing rate", "Refresh time", "Query latency (P95)"],
                strategy: "Python (multiprocessing) + `fio` for 40/40/20 distribution",
                query: "exists:acl_entries / Avg agg on acl_count",
                baselineCrawl: 15000, baselineIndex: 10000, priority: "High"
            },
            {
                id: "TC-002", name: "Finance Share Baseline", category: "Functional Baseline",
                files: "100,000", size: "500 GB", avgSize: "5 MB",
                depth: "4‚Äì6 levels", acl: "High (10-20 ACEs)",
                objective: "Evaluate metadata extraction latency with elevated ACL count and larger file volume.",
                metricsSX: ["ACL parsing time", "Scan completion time", "Memory avg/peak"],
                metricsES: ["Bulk request latency", "Segment count", "Heap utilization"],
                strategy: "PowerShell for precise NTFS ACL inheritance generation",
                query: "path_depth > 5 / Percentiles agg on file_size",
                baselineCrawl: 12000, baselineIndex: 8000, priority: "High"
            },
            {
                id: "TC-003", name: "IT Operations Logs", category: "Functional Baseline",
                files: "75,000", size: "750 GB", avgSize: "10 MB",
                depth: "5‚Äì7 levels", acl: "Standard (5-10 ACEs)",
                objective: "Measure throughput for mid-sized logs and installers.",
                metricsSX: ["Data Throughput (MB/sec)", "CPU utilization", "Queue depth"],
                metricsES: ["Indexing rate", "Shard size distribution"],
                strategy: "Bash + `dd` + `fio` for mixed log/binary generation",
                query: "extension.keyword : 'log' / Terms agg on extension.keyword",
                baselineCrawl: 10000, baselineIndex: 7500, priority: "Medium"
            },
            {
                id: "TC-004", name: "User Home Directories", category: "Functional Baseline",
                files: "100,000", size: "500 GB", avgSize: "5 MB",
                depth: "3 levels", acl: "Distinct per user",
                objective: "Validate crawl partitioning across 500 parallel user root directories.",
                metricsSX: ["Crawl Throughput", "Thread pool saturation", "Queue depth"],
                metricsES: ["Refresh time", "Query latency (P99)"],
                strategy: "Python + `faker` for 500 unique user dirs and ACL mapping",
                query: "owner.keyword : * / Cardinality agg on owner.keyword",
                baselineCrawl: 18000, baselineIndex: 12000, priority: "High"
            },
            {
                id: "TC-005", name: "PST Archive Repo", category: "Functional Baseline",
                files: "50,000", size: "25 TB", avgSize: "500 MB",
                depth: "2 levels", acl: "Standard (5 ACEs)",
                objective: "Test sustained data throughput and heap stability with max-tier file sizes.",
                metricsSX: ["Data Throughput (MB/sec)", "Memory avg/peak", "Error rate"],
                metricsES: ["Bulk request latency", "Field data memory"],
                strategy: "Parallel `fio` focused on 50MB-1GB range limit",
                query: "extension.keyword : 'pst' / Histogram on file_size",
                baselineCrawl: 5000, baselineIndex: 4000, priority: "Medium"
            },
            {
                id: "TC-006", name: "1M Single Directory", category: "Scale & Stress",
                files: "1,000,000", size: "1 TB", avgSize: "1 MB",
                depth: "1 level", acl: "Standard (5 ACEs)",
                objective: "Push file system enumeration bounds and StorageX directory queue backlog.",
                metricsSX: ["Queue depth", "Scan completion time", "Memory peak"],
                metricsES: ["Rejected bulk requests", "Indexing rate"],
                strategy: "Python `os` optimized fast-file creation + `fio`",
                query: "file_size > 1000 / Stats agg on crawl_timestamp",
                baselineCrawl: 0, baselineIndex: 5000, // Crawl bottleneck implies hard to quantify rate, using 0 for chart outlier or low val
                baselineCrawlDisplay: "Bottleneck",
                priority: "High"
            },
            {
                id: "TC-007", name: "5M Multi-Level Scale", category: "Scale & Stress",
                files: "5,000,000", size: "2.5 TB", avgSize: "500 KB",
                depth: "8 levels", acl: "Standard (5 ACEs)",
                objective: "Test endurance, index refresh impact, and thread pool exhaustion over long run.",
                metricsSX: ["Crawl Throughput", "CPU/Memory peak", "Retry count"],
                metricsES: ["Indexing rate", "Heap utilization", "Segment count"],
                strategy: "Distributed Python generators across multiple NAS nodes",
                query: "path_depth > 5 / Histogram on file_size",
                baselineCrawl: 20000, baselineIndex: 15000, priority: "Critical"
            },
            {
                id: "TC-008", name: "100K x 200MB Average", category: "Scale & Stress",
                files: "100,000", size: "20 TB", avgSize: "200 MB",
                depth: "4 levels", acl: "Standard (5 ACEs)",
                objective: "Push maximum sustained StorageX data plane IO and ES bulk payload sizes.",
                metricsSX: ["Data Throughput (MB/sec)", "Extract latency"],
                metricsES: ["Bulk request latency", "Heap utilization", "Shard size"],
                strategy: "`fio` sequential write profiles (200MB target)",
                query: "file_size > 100000000 / Percentiles agg on file_size",
                baselineCrawl: 3000, baselineIndex: 0, // Latency metric provided, converting to indicative rate for chart or hiding
                baselineIndexDisplay: "< 50ms Latency",
                priority: "Medium"
            },
            {
                id: "TC-009", name: "Extreme ACL Density", category: "Scale & Stress",
                files: "100,000", size: "100 GB", avgSize: "1 MB",
                depth: "3 levels", acl: "Extreme (200 ACEs)",
                objective: "Stress the ACL parsing engine and ES mapping pressure (JSON array explosion).",
                metricsSX: ["ACL parsing time", "Metadata extraction time", "CPU util"],
                metricsES: ["Field data memory", "Indexing rate", "Bulk request latency"],
                strategy: "PowerShell scripting to inject 200+ distinct AD groups",
                query: "exists:acl_entries / Avg agg on acl_count",
                baselineCrawl: 0, // Spike
                baselineCrawlDisplay: "Latency Spike",
                baselineIndex: 4000, priority: "High"
            },
            {
                id: "TC-010", name: "High Cardinality Owner", category: "Scale & Stress",
                files: "500,000", size: "50 GB", avgSize: "100 KB",
                depth: "4 levels", acl: "Variable",
                objective: "Stress Elasticsearch keyword indexing, global ordinals, and cardinality aggregations.",
                metricsSX: ["Crawl Throughput", "Memory utilization"],
                metricsES: ["Heap utilization", "Query latency (P99)", "Field data memory"],
                strategy: "Python + `faker` generating unique string payloads for owner",
                query: "owner.keyword : * / Cardinality agg on owner.keyword",
                baselineCrawl: 25000, baselineIndex: 18000, priority: "High"
            },
            {
                id: "TC-011", name: "Zero-Byte Explosion", category: "Metadata Stress",
                files: "500,000", size: "0 GB", avgSize: "0 KB",
                depth: "3 levels", acl: "Standard (5 ACEs)",
                objective: "Maximum metadata API stress without storage I/O drag. Tests pure software overhead.",
                metricsSX: ["Crawl Throughput", "Queue depth", "CPU utilization"],
                metricsES: ["Indexing rate", "Rejected bulk requests"],
                strategy: "Bash `touch` / Python `os.mknod` parallel burst",
                query: "file_size : 0 / Terms agg on extension.keyword",
                baselineCrawl: 35000, baselineIndex: 25000, priority: "High"
            },
            {
                id: "TC-012", name: "Deep Path Limit Testing", category: "Metadata Stress",
                files: "100,000", size: "1 GB", avgSize: "10 KB",
                depth: "50+ levels", acl: "Standard (5 ACEs)",
                objective: "Push OS path limits (255 chars) to test StorageX buffer overruns and ES path tokenization.",
                metricsSX: ["Error rate", "Retry count", "Scan completion time"],
                metricsES: ["Indexing rate", "Mapping pressure"],
                strategy: "Bash nested `mkdir -p` loop + `touch`",
                query: "path_depth > 20 / Stats agg on path_depth",
                baselineCrawl: 0, baselineCrawlDisplay: "Degradation",
                baselineIndex: 15000, priority: "Medium"
            },
            {
                id: "TC-013", name: "Directory Fan-Out", category: "Metadata Stress",
                files: "500,000", size: "5 GB", avgSize: "10 KB",
                depth: "2 levels", acl: "Standard (5 ACEs)",
                objective: "Force StorageX directory enumeration timeouts (250K files per single folder).",
                metricsSX: ["Queue depth", "Scan completion time", "Error rate"],
                metricsES: ["Indexing rate", "Bulk request latency"],
                strategy: "Python `os` direct system calls (bypassing shell limits)",
                query: "path_depth : 2 / Histogram on file_size",
                baselineCrawl: 0, baselineCrawlDisplay: "Enum Spikes",
                baselineIndex: 10000, priority: "High"
            },
            {
                id: "TC-014", name: "Timestamp Chaos", category: "Metadata Stress",
                files: "200,000", size: "200 GB", avgSize: "1 MB",
                depth: "4 levels", acl: "Standard (5 ACEs)",
                objective: "Break sequential timeline caching; stress ES date indexing and segment merging.",
                metricsSX: ["Metadata extraction time"],
                metricsES: ["Segment count", "Indexing rate", "Query latency"],
                strategy: "Python `os.utime` with randomized epochs (1975-2026)",
                query: "crawl_timestamp : * / Stats agg on crawl_timestamp",
                baselineCrawl: 18000, baselineIndex: 15000, priority: "Medium"
            },
            {
                id: "TC-015", name: "Extension Cardinality", category: "Metadata Stress",
                files: "1,000,000", size: "0 GB", avgSize: "0 KB",
                depth: "3 levels", acl: "Standard (5 ACEs)",
                objective: "Stress Elasticsearch mapping dynamic updates and Terms aggregation heap usage.",
                metricsSX: ["Crawl Throughput"],
                metricsES: ["Mapping pressure", "Field data memory", "Query latency (P99)"],
                strategy: "Python UUID generator for random file extensions",
                query: "extension.keyword : * / Terms agg on extension.keyword",
                baselineCrawl: 30000, baselineIndex: 0, baselineIndexDisplay: "Mapping Explosion", priority: "Critical"
            }
        ];

        // --- GLOBAL VARIABLES ---
        let currentFilter = 'all';
        let perfChartInstance = null;
        let distChartInstance = null;

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            initDashboard();
            renderList();
            renderDistChart();
            renderPerfChart();
            // Select first item by default
            selectTestCase(testCases[0].id);
        });

        // --- FUNCTIONS ---

        function initDashboard() {
            // Count totals
            // Note: Simplistic summing of strings, in a real app would parse '50,000'
            // Using pre-calculated values for the KPI cards as per the plan summary.
            // 9.2M is summed manually from the table data.
        }

        function filterTests(category) {
            currentFilter = category;
            
            // Update buttons
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.dataset.filter === category) {
                    btn.classList.add('bg-blue-600', 'text-white', 'shadow-sm');
                    btn.classList.remove('bg-white', 'text-slate-700', 'border', 'hover:bg-slate-50');
                } else {
                    btn.classList.remove('bg-blue-600', 'text-white', 'shadow-sm');
                    btn.classList.add('bg-white', 'text-slate-700', 'border', 'hover:bg-slate-50');
                }
            });

            renderList();
            updatePerfChart();
        }

        function renderList() {
            const listContainer = document.getElementById('tc-list');
            listContainer.innerHTML = '';

            const filtered = currentFilter === 'all' 
                ? testCases 
                : testCases.filter(tc => tc.category === currentFilter);

            filtered.forEach(tc => {
                const priorityColor = tc.priority === 'Critical' ? 'text-red-600 bg-red-50' : 
                                      tc.priority === 'High' ? 'text-orange-600 bg-orange-50' : 
                                      'text-blue-600 bg-blue-50';

                const div = document.createElement('div');
                div.className = `p-4 cursor-pointer hover:bg-slate-50 transition-colors border-l-4 border-transparent`;
                div.id = `row-${tc.id}`;
                div.onclick = () => selectTestCase(tc.id);
                div.innerHTML = `
                    <div class="flex justify-between items-start mb-1">
                        <span class="font-mono text-xs text-slate-400 font-bold">${tc.id}</span>
                        <span class="text-xs font-medium px-2 py-0.5 rounded-full ${priorityColor}">${tc.priority}</span>
                    </div>
                    <h3 class="text-sm font-semibold text-slate-900 mb-1 leading-tight">${tc.name}</h3>
                    <p class="text-xs text-slate-500 truncate">${tc.objective}</p>
                `;
                listContainer.appendChild(div);
            });
        }

        function selectTestCase(id) {
            // Highlight row
            document.querySelectorAll('#tc-list > div').forEach(el => {
                el.classList.remove('active-row');
                if (el.id === `row-${id}`) el.classList.add('active-row');
            });

            const tc = testCases.find(t => t.id === id);
            if (!tc) return;

            // Render Detail
            const content = document.getElementById('tc-detail-content');
            
            // Format Metrics lists
            const sxMetrics = tc.metricsSX.map(m => `<li class="flex items-center"><span class="w-1.5 h-1.5 rounded-full bg-blue-500 mr-2"></span>${m}</li>`).join('');
            const esMetrics = tc.metricsES.map(m => `<li class="flex items-center"><span class="w-1.5 h-1.5 rounded-full bg-teal-500 mr-2"></span>${m}</li>`).join('');

            content.innerHTML = `
                <div class="animate-fade-in">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-2xl font-bold text-slate-900">${tc.id}: ${tc.name}</h2>
                        <span class="px-3 py-1 bg-slate-200 text-slate-700 rounded-full text-xs font-bold uppercase">${tc.category}</span>
                    </div>

                    <p class="text-slate-600 text-base mb-6 bg-white p-4 rounded-lg border border-slate-200 italic">
                        "${tc.objective}"
                    </p>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-100">
                            <h3 class="text-xs font-bold text-slate-400 uppercase mb-3">Dataset Profile</h3>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between"><span class="text-slate-500">Total Files:</span> <span class="font-mono font-semibold">${tc.files}</span></div>
                                <div class="flex justify-between"><span class="text-slate-500">Total Size:</span> <span class="font-mono font-semibold">${tc.size}</span></div>
                                <div class="flex justify-between"><span class="text-slate-500">Avg Size:</span> <span class="font-mono font-semibold">${tc.avgSize}</span></div>
                                <div class="flex justify-between"><span class="text-slate-500">Dir Depth:</span> <span class="font-mono font-semibold">${tc.depth}</span></div>
                                <div class="flex justify-between"><span class="text-slate-500">ACLs:</span> <span class="font-mono font-semibold">${tc.acl}</span></div>
                            </div>
                        </div>

                        <div class="bg-white p-4 rounded-lg shadow-sm border border-slate-100">
                            <h3 class="text-xs font-bold text-slate-400 uppercase mb-3">Expected Baseline</h3>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span class="text-slate-600">Crawl Rate</span>
                                        <span class="font-bold text-blue-600">${tc.baselineCrawlDisplay || tc.baselineCrawl + ' files/sec'}</span>
                                    </div>
                                    <div class="w-full bg-slate-100 rounded-full h-2">
                                        <div class="bg-blue-500 h-2 rounded-full" style="width: ${Math.min(100, (tc.baselineCrawl / 35000) * 100)}%"></div>
                                    </div>
                                </div>
                                <div>
                                    <div class="flex justify-between text-sm mb-1">
                                        <span class="text-slate-600">Index Rate</span>
                                        <span class="font-bold text-teal-600">${tc.baselineIndexDisplay || tc.baselineIndex + ' docs/sec'}</span>
                                    </div>
                                    <div class="w-full bg-slate-100 rounded-full h-2">
                                        <div class="bg-teal-500 h-2 rounded-full" style="width: ${Math.min(100, (tc.baselineIndex / 25000) * 100)}%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <h4 class="font-bold text-slate-900 mb-2 text-sm flex items-center">
                                <span class="bg-blue-100 text-blue-600 p-1 rounded mr-2 text-xs">StorageX</span> Metrics
                            </h4>
                            <ul class="text-sm text-slate-600 space-y-1 ml-1">
                                ${sxMetrics}
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-bold text-slate-900 mb-2 text-sm flex items-center">
                                <span class="bg-teal-100 text-teal-600 p-1 rounded mr-2 text-xs">Elastic</span> Metrics
                            </h4>
                            <ul class="text-sm text-slate-600 space-y-1 ml-1">
                                ${esMetrics}
                            </ul>
                        </div>
                    </div>

                    <div class="mb-4">
                        <h4 class="font-bold text-slate-900 mb-2 text-sm">Data Generation Strategy</h4>
                        <div class="bg-slate-800 text-slate-200 p-3 rounded text-sm font-mono border-l-4 border-indigo-500">
                            ${tc.strategy.replace(/`/g, '')}
                        </div>
                    </div>

                     <div>
                        <h4 class="font-bold text-slate-900 mb-2 text-sm">Validation Query Logic</h4>
                        <div class="bg-slate-100 text-slate-600 p-3 rounded text-sm font-mono">
                            ${tc.query}
                        </div>
                    </div>
                </div>
            `;
        }

        // --- CHARTS ---

        function renderDistChart() {
            const ctx = document.getElementById('distChart').getContext('2d');
            distChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Small (0-100KB)', 'Medium (100KB-50MB)', 'Large (50MB-1GB)'],
                    datasets: [{
                        data: [40, 40, 20],
                        backgroundColor: ['#93c5fd', '#3b82f6', '#1e40af'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { 
                            callbacks: {
                                label: (ctx) => ` ${ctx.label}: ${ctx.raw}%`
                            }
                        }
                    },
                    cutout: '65%'
                }
            });
        }

        function renderPerfChart() {
            const ctx = document.getElementById('perfChart').getContext('2d');
            perfChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [
                        {
                            label: 'Crawl Throughput (Files/sec)',
                            data: [],
                            backgroundColor: '#3b82f6',
                            borderRadius: 4,
                            barPercentage: 0.6
                        },
                        {
                            label: 'Index Rate (Docs/sec)',
                            data: [],
                            backgroundColor: '#14b8a6',
                            borderRadius: 4,
                            barPercentage: 0.6
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: '#f1f5f9' },
                            title: { display: true, text: 'Operations / Sec' }
                        },
                        x: {
                            grid: { display: false },
                            ticks: { maxRotation: 45, minRotation: 45, font: { size: 10 } }
                        }
                    },
                    plugins: {
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: 'rgba(15, 23, 42, 0.9)',
                            padding: 12
                        },
                        legend: { position: 'top', align: 'end' }
                    }
                }
            });
            updatePerfChart();
        }

        function updatePerfChart() {
            if (!perfChartInstance) return;

            const filtered = currentFilter === 'all' 
                ? testCases 
                : testCases.filter(tc => tc.category === currentFilter);

            // Sort by expected index rate for cleaner viz
            // filtered.sort((a, b) => (b.baselineIndex || 0) - (a.baselineIndex || 0));

            perfChartInstance.data.labels = filtered.map(tc => tc.id);
            perfChartInstance.data.datasets[0].data = filtered.map(tc => tc.baselineCrawl || 0);
            perfChartInstance.data.datasets[1].data = filtered.map(tc => tc.baselineIndex || 0);
            
            perfChartInstance.update();
        }

    </script>
</body>
</html>